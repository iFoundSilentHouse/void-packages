# Template file for 'InfiniSim'
pkgname=InfiniSim
version=1.13.0
revision=1
build_wrksrc=${pkgname}-${version}
build_style=cmake
hostmakedepends="nodejs python3 python3-Pillow"
makedepends="SDL2-devel zlib-devel"
short_desc="Simulator for InfiniTime user interface without needing a PineTime"
maintainer="iFoundSilentHouse <adeptslab@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://github.com/InfiniTimeOrg/InfiniSim"
_InfiniTime_ver=1.13.0
_lv_drivers_ver=7.11.0
_libpng_ver=1.6.38
_lvgl_hash=7c96fb87e33733a7a67b33bf8057e598c6843e3a
_littlefs_hash=ead50807f1ca3fdf2da00b77a0ce02651ded2d13
_QCBOR_hash=56b17bf9f74096774944bcac0829adcd887d391e
_arduinoFFT_hash=419d7b044e56b87de8efbcf76f09c04759628fb4
_lv_font_conv_ver=1.5.2
distfiles="https://github.com/InfiniTimeOrg/InfiniSim/archive/refs/tags/v${version}.tar.gz
 https://github.com/InfiniTimeOrg/InfiniTime/archive/refs/tags/${_InfiniTime_ver}.tar.gz>InfiniTime-${_InfiniTime_ver}.tgz
 https://github.com/lvgl/lv_drivers/archive/refs/tags/v${_lv_drivers_ver}.tar.gz>lv_drivers-${_lv_drivers_ver}.tgz
 https://github.com/pnggroup/libpng/archive/refs/tags/v${_libpng_ver}.tar.gz>libpng-${_libpng_ver}.tgz
 https://github.com/InfiniTimeOrg/lvgl/archive/${_lvgl_hash}.tar.gz>lvgl-${_lvgl_hash}.tgz
 https://github.com/littlefs-project/littlefs/archive/${_littlefs_hash}.tar.gz>littlefs-${_littlefs_hash}.tgz
 https://github.com/laurencelundblade/QCBOR/archive/${_QCBOR_hash}.tar.gz>QCBOR-${_QCBOR_hash}.tgz
 https://github.com/kosme/arduinoFFT/archive/${_arduinoFFT_hash}.tar.gz>arduinoFFT-${_arduinoFFT_hash}.tgz"
checksum="e82a7df815e4dcdf21c8398ff53ecb26735f6f47e7455a944f3ac3840732f379
 313acfc43a1967644e681c936e5c6901872f24a08bc76b3fdf980254ebf062b1
 b82437f9dbd24097b323524b6a58882fd2139535d6323bb5c36f13a6f3490fed
 d4160037fa5d09fa7cff555037f2a7f2fefc99ca01e21723b19bfcda33015234
 12330f4f48bf3b0fb516317bb474de425076c20778a872b339db3947b52db729
 c53739b21d31d014efdc01e46cf8e06912d6b19b1a9f2ab02fa956318d70b7c1
 7c008066f1e8d1b75aba78e569cc7fa8cef48aa3e75c581891523b53fbc6850a
 752d601bc2b3af66e676edd55536fadc7f6eee4ee73c7f5737c2ab4d96f952eb"

skip_extraction="InfiniTime-${_InfiniTime_ver}.tgz
 lv_drivers-${_lv_drivers_ver}.tar.gz
 libpng-${_libpng_ver}.tgz
 lvgl-${_lvgl_hash}.tgz
 littlefs-${_littlefs_hash}.tgz
 QCBOR-${_QCBOR_hash}.tgz
 arduinoFFT-${_arduinoFFT_hash}.tgz"

post_extract() {
	vsrcextract -C ${build_wrksrc}/InfiniTime InfiniTime-${_InfiniTime_ver}.tgz
	vsrcextract -C ${build_wrksrc}/lv_drivers lv_drivers-${_lv_drivers_ver}.tgz
	vsrcextract -C ${build_wrksrc}/libpng libpng-${_libpng_ver}.tgz
	vsrcextract -C ${build_wrksrc}/InfiniTime/src/libs/lvgl lvgl-${_lvgl_hash}.tgz
	vsrcextract -C ${build_wrksrc}/InfiniTime/src/libs/littlefs littlefs-${_littlefs_hash}.tgz
	vsrcextract -C ${build_wrksrc}/InfiniTime/src/libs/QCBOR QCBOR-${_QCBOR_hash}.tgz
	vsrcextract -C ${build_wrksrc}/InfiniTime/src/libs/arduinoFFT arduinoFFT-${_arduinoFFT_hash}.tgz
}

pre_configure() {
	npm install lv_font_conv@${_lv_font_conv_ver}
}

post_install() {
	vbin build/littlefs-do
}
