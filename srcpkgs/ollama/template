# Template file for 'ollama'
pkgname=ollama
version=0.1.32
revision=1
_llama_cpp_hash=7593639ce335e8d7f89aa9a54d616951f273af60
archs="x86_64* aarch64*"
build_style=go
go_import_path="github.com/ollama/ollama"
hostmakedepends="cmake git"
short_desc="Get up and running with large language models, locally"
maintainer="IFoundSilentHouse <adeptslab@gmail.com>"
license="MIT"
homepage="https://ollama.com/"
distfiles="https://github.com/ollama/ollama/archive/refs/tags/v${version}.tar.gz
 https://github.com/ggerganov/llama.cpp/archive/${_llama_cpp_hash}.tar.gz>llama.cpp-${_llama_cpp_hash}.tgz"
checksum="b8f43a9ce7731c8e19d801e6c08145e779ee607bf22864e495041e4440c5c283
 3183900a2825281df1bd6825b183f8df7febe9dfa666d3197ad6df44007678e1"

system_accounts=_ollama

skip_extraction=llama.cpp-${_llama_cpp_hash}.tgz

post_extract() {
	vsrcextract -C llm/llama.cpp llama.cpp-${_llama_cpp_hash}.tgz
}

pre_build() {
	# "go generate" script uses "git submodule" command
	git init
	git add .
	go generate ./...
}

post_install() {
	vlicense LICENSE
	vsv ollama
}
