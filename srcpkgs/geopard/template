# Template file for 'geopard'
pkgname=geopard
version=1.5.0
revision=1
build_style=meson
build_helper=rust
hostmakedepends="cargo gettext blueprint-compiler gtk4-update-icon-cache
 pkg-config glib-devel AppStream desktop-file-utils"
makedepends="gdk-pixbuf-devel pango-devel gtk4-devel libadwaita-devel rust-std"
short_desc="Colorful, adaptive gemini browser"
maintainer="iFoundSilentHouse <adeptslab@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://ranfdev.com/projects/Geopard"
distfiles="https://github.com/ranfdev/Geopard/archive/refs/tags/v${version}.tar.gz"
checksum=04f317d5586344dc9e3964a0e999aeac231cb5a9ff63071ea051926f54d18577

if [ "$CROSS_BUILD" ]; then
	makedepends+=" libgirepository-devel gobject-introspection"
fi

pre_build() {
	rm -rf ${wrksrc}/subprojects/blueprint-compiler.wrap

	if [ "$CROSS_BUILD" ]; then
		export GI_TYPELIB_PATH="${XBPS_CROSS_BASE}/usr/lib/girepository-1.0"
		vsed -i build/build.ninja \
			-e "s;cp src/release/geopard;cp src/${RUST_TARGET}/release/geopard;"
	fi
}
